# Modern Warships チャット機能

今回，チャットの機能を色々検証した。カスタムルームを作成し，カスタムチャットで行った。カスタムチャットの仕様はグローバルチャットやクランチャットでも同様だと思う(未確認)。

動機は，戦闘行くと落ちるから。あとMarkdown自分で書いてみたかった。

## コマンド

クランおよびカスタムの招待用カードを発行する`post_invite_card`というコマンドを発見した(招待用のコピペボタンがある)。それ以外は未確認。

以下，変数部分は`<変数>`と表記する。変数名は勝手に名付けた。

### クラン招待

基本書式
```
post_invite_card clan_<クランID>
```

制約事項
- `post_invite_card`の直後の空白は任意個でいい，なぜか空白0個でいけた
- `クランID`は6桁の英大文字と数字(トップ50のクランをぱっと見)，自分が在籍しているクランのIDでなければ入力不可になる(赤メッセージ出る)
- 5分間のクールタイム有り(黄色メッセージ出たり出なかったり)，別チャットでも再起動してもリセット無し

### カスタム招待

基本書式
```
post_invite_card custom_roomId<ルームID>&class<艦種ID>&tier<ティアID>&count<戦闘形式ID>&cardmap_<マップID>
```

見やすく整形(文法無視)
```
post_invite_card
   custom_roomId<ルームID>  <- なんでスネークケースかキャメルケースか統一しないの
  &class<艦種ID>
  &tier<ティアID>
  &count<戦闘形式ID>
  &cardmap_<マップID>  <- なんでこれだけ_で区切るの
```

制約事項
- 過不足無くこの順でなければ入力不可になる
- `post_invite_card`の直後の空白は任意個でいい，なぜか空白0個でいけた
- 続く引数を`&`で区切る，空白等が存在すると入力不可になる
- `ルームID`は4桁の数字，現在参加しているカスタムルームのIDでなければ`作成したカスタムルームは招待状の期限が切れました。次の招待をお待ち下さい`を入力したことになる
- `艦種ID`は`all`または`0`から`30`までの整数の`,`区切りの羅列，連続した`,`または末尾の`,`が存在すると入力不可になる，`31`-`40`がだめだったから`41`以上もだめそう，重複いける，個数無制限，記述順にロゴが表示される，7個で改行される(端末差あるかも)，背景もそれに応じて下に伸びる
  |艦種ID   |艦種名                            |
  |:-------:|:-------------------------------:|
  |`all`    |全て(`0,1,2,3,4,5,6,7,8,10`と等価)|
  |`0`      |コルベット艦                      |
  |`1`      |フリゲート艦                      |
  |`2`      |駆逐艦                            |
  |`3`      |巡洋艦                            |
  |`4`      |戦艦                              |
  |`5`      |航空母艦                          |
  |`6`      |潜水艦                            |
  |`7`      |エクラノプラン                     |
  |`8`      |強襲型空母                         |
  |`9`      |無(なんで)                         |
  |`10`     |強襲揚陸艦                         |
  |`11`-`14`|無                                |
  |`15`     |不明(カブトムシ?)                  |
  |`16`-`17`|無                                |
  |`18`     |スカイキャリア                     |
  |`19`-`29`|無                                |
  |`30`     |無人潜水艇(公称不明)                |
- `ティアID`は`all`または`1`から`3`までの整数の`,`区切りの羅列，重複いける，個数無制限，昇順に表示される，改行されず右にあふれる
- `戦闘形式ID`は`1`から`5`までの整数，1チームの人数と同じ，たぶんだけど1対1の戦闘を募集しても5対5できると思う(未確認)
- `マップID`はマップを識別する文字列，なぜ英語名と揃えない，いけるってことはそういう名前のマップがあるってこと，`_TDM`有り無しの差は何
  |日本語                          |英語           |マップIDの接尾辞|
  |:-----------------------------:|:-------------:|:-------------:|
  |チームデスマッチ(私は通常戦と呼ぶ)|TEAM DEATHMATCH|TDM            |
  |占領戦                          |DOMINATION     |DM             |
  |共闘戦                          |TANDEM WARS    |TW             |
  |護衛戦                          |ESCORT MODE(?) |EC             |

  |マップID                 |マップ英語名        |マップ日本語名       |占領戦|共闘戦 |護衛戦|` `|`_TDM`|`_DM`|`_TW`|`_EC`|備考|
  |:----------------------:|:-----------------:|:------------------:|:----:|:----:|:-----|:-:|:----:|:---:|:---:|:---:|:--:|
  |`Greenlands`            |Greenlands         |緑の諸島             |X     |X     |X     |O  |X     |X    |X    |X    |    |
  |`Strom`                 |Strom              |嵐                  |X     |X     |X     |O  |O     |X    |X    |X    |    |
  |`UnexploredRocks`       |Unexplored Rocks   |未踏の岩             |X     |X     |X     |O  |X     |X    |X    |X    |    |
  |`StormDay`              |Islands of Iceland |アイスランド諸島      |X     |X     |X     |O  |X     |X    |X    |X    |    |
  |`IceWorld`              |Arctic             |北極圏               |X     |O     |x?    |O  |X     |X    |O    |X    |護衛戦あったけど消えた|
  |`VikingBay`             |Viking Bay         |海賊の入り江         |o?    |O     |X     |O  |X     |O    |O    |X    |占領戦の神秘湾はサムネは海賊の入り江と同じな気がする，`_DM`付加して表示されるマップ名は海賊の入り江 -> 同じらしい，変な名前付けんな|
  |`StonePeaks`            |Stone Peaks        |秘境の岩山           |X     |X     |X     |O  |X     |X    |X    |X    |    |
  |`TwoSamurai`            |Two Samurai        |二人の侍             |O     |O     |O     |O  |X     |O    |O    |O    |通常戦と占領戦でマップ構造が同一|
  |`HiddenDragon_TDM`      |Hidden Dragon      |隠れた龍             |X     |O     |X     |O  |O     |X    |O    |X    |    |
  |`MonstrousMaelstorm_TDM`|Monstrous Maelstorm|巨大うずまき         |O     |X     |O     |O  |O     |**X**|X    |O    |    |
  |`AridFrontier_TDM`      |Arid Frontier      |砂漠のフロンティア    |X     |O     |O     |O  |O     |X    |O    |X    |    |
  |`PolarFrontier_TDM`     |Polar Frontier     |極地戦線             |X     |X     |X     |X  |O     |X    |X    |X    |    |
  |`LostCity_TDM`          |Lost City          |失われた都市         |O     |X     |X     |O  |O     |**X**|X    |**O**|    |
  |`Strom_TDM`             |Strom              |嵐                  |X     |X     |X     |O  |O     |X    |X    |X    |石油リグみたいなのある方|
- 完全に同じ文字列を再度入力すると5分間のクールタイム有り，黄色メッセージ出る，別チャットでも再起動してもリセット無し，末尾に空白と1個以上の任意の文字を付加すると回避できる

#### お遊び用

```
post_invite_card custom_roomId____&class9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9&tier1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1&count1&cardmap_Strom
```

## 入力制限
https
http:
行頭の空白と行末の空白はトリミングされる
外部からコピペすると改行は空白に変換されるぽい
post_invite_card以降で過不足があると入力できない
1人でカスタムで連投してたら赤メッセージで`利用不可`とでた，1分ぐらいミュート食らってたのかも，再起動で直ったのかも

